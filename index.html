<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#f7f1e6" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
  <meta name="description" content="Browse and search Rock Band 3 songs from your RPCS3 library" />
  <title>Gig-E's Rock Band Songs DB</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>Gig-E's Rock Band Songs DB</h1>
    <div class="badge" id="status">Loading catalog…</div>
    <div class="meta" id="last-updated">Last built: —</div>
    <div class="header-actions">
      <a href="admin.html" class="admin-link">⚙️ Admin</a>
      <button class="settings-btn" id="settings-btn">Settings</button>
    </div>
  </header>

  <main>
    <section class="panel filters-panel">
      <div class="controls">
        <div>
          <label for="search">Search</label>
          <input id="search" type="text" placeholder="Artist, title, album, pack…" />
        </div>
        <div>
          <label for="artist">Artist</label>
          <select id="artist"></select>
        </div>
        <div>
          <label for="title">Title</label>
          <select id="title"></select>
        </div>
        <div>
          <label for="type">Type</label>
          <select id="type"></select>
        </div>
        <div>
          <label for="pack">Pack</label>
          <select id="pack"></select>
        </div>
        <div>
          <label for="genre">Genre</label>
          <select id="genre"></select>
        </div>
        <div>
          <label for="year">Decade</label>
          <select id="year"></select>
        </div>
        <div class="inline">
          <input id="eurovision" type="checkbox" />
          <label for="eurovision">Eurovision</label>
        </div>
        <div class="inline">
          <button id="update">Update DB</button>
          <button class="ghost" id="reset">Reset filters</button>
        </div>
      </div>
      <div class="notice" id="notice"></div>
      <div class="pack-warning" id="pack-warning" style="display: none;">
        ⚠️ You have <strong id="pack-warning-count">0</strong> packs.
        <a href="admin.html">Consider merging packs</a> to improve RPCS3 loading times.
      </div>
    </section>

    <section class="panel">
      <div class="deletion-controls" id="deletion-controls">
        <span class="selection-info" id="selection-info">0 songs selected</span>
        <div class="deletion-buttons">
          <button class="ghost" id="select-pack">Select All in Pack...</button>
          <button class="danger" id="delete-selected" disabled>Delete Selected</button>
        </div>
      </div>
      <div class="badge" id="count">0 songs</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" id="select-all" title="Select/deselect all" /></th>
              <th>Artist</th>
              <th>Title</th>
              <th>Album</th>
              <th>Year</th>
              <th>Type</th>
              <th>Pack</th>
              <th>Source</th>
            </tr>
          </thead>
          <tbody id="songs-body"></tbody>
        </table>
        <div id="song-cards" class="song-cards"></div>
      </div>
    </section>

    <section class="panel">
      <h3>Sources</h3>
      <div class="sources" id="sources"></div>
    </section>
  </main>

  <div class="modal" id="settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="settings-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="dev-hdd0-path">dev_hdd0 Directory Path</label>
          <input type="text" id="dev-hdd0-path" placeholder="/home/user/.config/rpcs3/dev_hdd0" />
          <div class="setting-hint">Absolute path to your RPCS3 dev_hdd0 directory containing songs.dta files</div>
          <div class="setting-status" id="path-status"></div>
        </div>
        <div class="modal-actions">
          <button class="primary" id="save-settings">Save & Rebuild</button>
          <button class="ghost" id="validate-path">Validate Path</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>⚠️ Confirm Deletion</h2>
        <button class="modal-close" id="delete-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="warning-box">
          <p><strong>You are about to permanently delete <span id="delete-count">0</span> songs.</strong></p>
          <p>This will free approximately <span id="delete-size">calculating...</span> of disk space.</p>
          <p>Song entries will be removed from songs.dta files and song folders will be deleted.</p>
        </div>

        <div class="delete-preview" id="delete-preview">
          <!-- Song list populated by JS -->
        </div>

        <div class="deletion-details">
          <h4>What will be deleted:</h4>
          <ul>
            <li>Song entries from songs.dta (backup created)</li>
            <li>Song folders with .mid, .mogg, and image files</li>
          </ul>
          <h4>Backups created:</h4>
          <ul>
            <li>songs.dta → songs.dta.backup.[timestamp]</li>
            <li>Folders → [name].deleted_[timestamp]</li>
          </ul>
        </div>
      </div>
      <div class="modal-actions">
        <button class="danger primary" id="confirm-delete">Delete Songs</button>
        <button class="ghost" id="cancel-delete">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="pack-select-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Select All Songs in Pack</h2>
        <button class="modal-close" id="pack-select-close">&times;</button>
      </div>
      <div class="modal-body">
        <p>Choose a pack to select all its songs:</p>
        <select id="pack-selector" size="10" style="width: 100%; margin-top: 12px;">
          <!-- Populated by JS -->
        </select>
      </div>
      <div class="modal-actions">
        <button class="primary" id="confirm-pack-select">Select</button>
        <button class="ghost" id="cancel-pack-select">Cancel</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
